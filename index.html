<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–æ—Ä–º–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É –≥—Ä—É–∑–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #f5f5f5;
            --tg-theme-text-color: #333;
            --tg-theme-hint-color: #999;
            --tg-theme-link-color: #2678b6;
            --tg-theme-button-color: #3498db;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f0f0f0;
            
            /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏ */
            --tab-bg-color: rgba(255, 255, 255, 0.2);
            --tab-active-bg-color: rgba(255, 255, 255, 0.3);
            --tab-text-color: #ffffff;
            --label-color: #ffffff;
            --border-color: rgba(255, 255, 255, 0.3);
            --checkbox-border-color: rgba(255, 255, 255, 0.5);
            --option-bg-color: rgba(255, 255, 255, 0.1);
            --option-hover-bg-color: rgba(255, 255, 255, 0.2);
        }
        
        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
        .light-theme {
            --tg-theme-bg-color: #f5f5f5;
            --tg-theme-text-color: #333;
            --tg-theme-hint-color: #999;
            --tg-theme-link-color: #2678b6;
            --tg-theme-button-color: #3498db;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f0f0f0;
            
            --tab-bg-color: #e0e0e0;
            --tab-active-bg-color: #ffffff;
            --tab-text-color: #333333;
            --label-color: #333333;
            --border-color: rgba(0, 0, 0, 0.2);
            --checkbox-border-color: rgba(0, 0, 0, 0.3);
            --option-bg-color: #f0f0f0;
            --option-hover-bg-color: #e5e5e5;
        }
        
        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
        .dark-theme {
            --tg-theme-bg-color: #222;
            --tg-theme-text-color: #fff;
            --tg-theme-hint-color: #aaa;
            --tg-theme-link-color: #64b5f6;
            --tg-theme-button-color: #50a8e6;
            --tg-theme-button-text-color: #fff;
            --tg-theme-secondary-bg-color: #333;
            
            --tab-bg-color: rgba(255, 255, 255, 0.2);
            --tab-active-bg-color: rgba(255, 255, 255, 0.3);
            --tab-text-color: #ffffff;
            --label-color: #ffffff;
            --border-color: rgba(255, 255, 255, 0.3);
            --checkbox-border-color: rgba(255, 255, 255, 0.5);
            --option-bg-color: rgba(255, 255, 255, 0.1);
            --option-hover-bg-color: rgba(255, 255, 255, 0.2);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 16px;
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--tg-theme-bg-color);
            padding: 16px;
            border-radius: 8px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--tg-theme-text-color);
            font-size: 24px;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--label-color);
        }
        
        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            background-color: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
        }
        
        select:focus, input:focus, textarea:focus {
            border-color: var(--tg-theme-button-color);
            outline: none;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .input-group input {
            flex: 1;
        }
        
        .input-group select {
            width: 120px;
        }
        
        select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        button {
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: opacity 0.3s;
            width: 100%;
            max-width: 300px;
            margin: 30px auto;
            display: block;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        .address-display {
            margin-top: 10px;
            padding: 12px;
            background-color: var(--tg-theme-secondary-bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            color: var(--tg-theme-text-color);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: var(--tg-theme-hint-color);
        }
        
        .error {
            color: #e74c3c;
            padding: 10px;
            background-color: rgba(231, 76, 60, 0.1);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            background-color: var(--tab-bg-color);
            color: var(--tab-text-color);
            position: relative;
        }
        
        .tab.active {
            background-color: var(--tab-active-bg-color);
            border-bottom: 1px solid var(--tab-active-bg-color);
            margin-bottom: -1px;
            font-weight: 500;
        }
        
        .tab-close {
            display: inline-block;
            width: 16px;
            height: 16px;
            line-height: 14px;
            text-align: center;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            color: var(--tab-text-color);
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
            cursor: pointer;
            vertical-align: middle;
        }
        
        .tab-close:hover {
            background-color: rgba(231, 76, 60, 0.7);
            color: #fff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .add-tab-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 14px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 30px;
            max-width: 30px;
        }
        
        .add-tab-btn:hover {
            opacity: 0.9;
        }
        
        .customer-info {
            background-color: var(--tg-theme-secondary-bg-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            color: var(--tg-theme-text-color);
        }
        
        .customer-info h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 18px;
            color: var(--tg-theme-text-color);
        }
        
        .customer-info p {
            margin: 5px 0;
            color: var(--tg-theme-text-color);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--tg-theme-button-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–æ–∫ –∏ —á–µ–∫–±–æ–∫—Å–æ–≤ */
        .radio-group, .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 5px;
        }
        
        .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
            background-color: var(--option-bg-color);
            border-radius: 8px;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
        }
        
        .radio-option:hover, .checkbox-option:hover {
            background-color: var(--option-hover-bg-color);
        }
        
        .radio-option input, .checkbox-option input {
            width: auto;
            margin-right: 10px;
            accent-color: var(--tg-theme-button-color);
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è label –≤–Ω—É—Ç—Ä–∏ option */
        .radio-option label, .checkbox-option label {
            margin-bottom: 0;
            display: flex;
            align-items: center;
            width: 100%;
            cursor: pointer;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ checkbox-–∫–Ω–æ–ø–æ–∫ */
        .checkbox-option {
            flex-direction: row;
        }
        
        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
        .theme-switch-container {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .theme-switch-label {
            margin-right: 10px;
            color: var(--tg-theme-text-color);
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 5px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            z-index: 2;
        }
        
        input:checked + .slider {
            background-color: #2196F3;
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        .slider .light-icon,
        .slider .dark-icon {
            position: relative;
            z-index: 1;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            line-height: 1;
            text-align: center;
        }
        
        /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —ç–º–æ–¥–∑–∏ */
        @media (max-width: 768px) {
            .slider .light-icon,
            .slider .dark-icon {
                font-size: 12px;
            }
        }
        
        .slider .light-icon {
            color: #fff;
            margin-right: 4px;
        }
        
        .slider .dark-icon {
            color: #333;
            margin-left: 4px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ */
        .time-range {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .time-range select {
            flex: 1;
        }
        
        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 12px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .form-group {
                margin-bottom: 16px;
            }
            
            select, input, textarea {
                padding: 10px;
                font-size: 16px;
            }
            
            .radio-group, .checkbox-group {
                gap: 8px;
            }
        }
        
        .pickup-warning {
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(255, 96, 64, 0.512);
            border: 1px solid #dc4949;
            border-radius: 8px;
            color: #f98964;
        }
        
        .pickup-warning p {
            margin: 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .warning-message {
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(255, 96, 64, 0.512);
            border: 1px solid #dc4949;
            border-radius: 8px;
            color: #f98964;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="theme-switch-container">
            <span class="theme-switch-label">–¢–µ–º–∞:</span>
            <label class="theme-switch">
                <input type="checkbox" id="themeToggle">
                <span class="slider">
                    <span class="light-icon">üåï</span>
                    <span class="dark-icon">üåë</span>
                </span>
            </label>
        </div>
        
        <h1>–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É –≥—Ä—É–∑–∞</h1>
        
        <div id="telegramUserInfo" class="customer-info hidden">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h3>
            <p>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: <span id="telegramUserId">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
            <p>–ò–º—è: <span id="telegramUserName">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        </div>
        
        <div id="loading" class="loading">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü—ã...
        </div>
        
        <div id="error" class="error hidden">
            –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.
        </div>
        
        <div id="tabsContainer" class="hidden">
            <div class="tabs" id="tabs">
                <div class="tab active" data-tab-id="tab1">–ó–∞–∫–∞–∑ 1</div>
                <button id="addTabBtn" class="add-tab-btn" title="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑">+</button>
            </div>
            
            <form id="cargoFormMain">
                <div id="tab1" class="tab-content active">
                    <!-- –§–æ—Ä–º–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                
                <button type="submit" id="submitButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
            </form>
        </div>
    </div>
    
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
    </div>

    <!-- –®–∞–±–ª–æ–Ω —Ñ–æ—Ä–º—ã (–±—É–¥–µ—Ç –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–∏) -->
    <template id="formTemplate">
        <div class="form-content">
            <div class="form-group">
                <label for="branch-{tabId}">–§–∏–ª–∏–∞–ª:</label>
                <select id="branch-{tabId}" class="branch" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª–∏–∞–ª</option>
                </select>
            </div>

            <div class="form-group">
                <label for="marketplace-{tabId}">–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å:</label>
                <select id="marketplace-{tabId}" class="marketplace" required disabled>
                    <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª–∏–∞–ª</option>
                </select>
            </div>

            <div class="form-group">
                <label for="city-{tabId}">–ì–æ—Ä–æ–¥:</label>
                <select id="city-{tabId}" class="city" required disabled>
                    <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</option>
                </select>
            </div>

            <div class="form-group">
                <label for="warehouse-{tabId}">–°–∫–ª–∞–¥:</label>
                <select id="warehouse-{tabId}" class="warehouse" required disabled>
                    <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–ê–¥—Ä–µ—Å —Å–∫–ª–∞–¥–∞:</label>
                <div id="address-{tabId}" class="address-display">–ê–¥—Ä–µ—Å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å–∫–ª–∞–¥–∞</div>
            </div>
            
            <div class="form-group">
                <label for="marketplaceShipmentDate-{tabId}">–î–∞—Ç–∞ –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å:</label>
                <select id="marketplaceShipmentDate-{tabId}" class="marketplaceShipmentDate" required disabled>
                    <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∫–ª–∞–¥</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="ncgShipmentDate-{tabId}">–î–∞—Ç–∞ –æ—Ç–≥—Ä—É–∑–∫–∏ –∫ –Ω–∞–º –Ω–∞ —Å–∫–ª–∞–¥ NCG:</label>
                <select id="ncgShipmentDate-{tabId}" class="ncgShipmentDate" required disabled>
                    <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</option>
                </select>
                <div id="ncg-date-warning-{tabId}" class="warning-message">–í –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–∑–º–æ–∂–Ω—ã–π –¥–ª—è –æ—Ç–≥—Ä—É–∑–∫–∏ –¥–µ–Ω—å –º–æ–∂–Ω–æ –ø—Ä–∏–≤–µ–∑—Ç–∏ –≥—Ä—É–∑ –¢–û–õ–¨–ö–û –¥–æ 12:00</div>
            </div>
            
            <div class="form-group">
                <label>–í–∏–¥ —É–ø–∞–∫–æ–≤–∫–∏ —Ç–æ–≤–∞—Ä–∞:</label>
                <div class="radio-group package-type-group">
                    <div class="radio-option">
                        <input type="radio" id="packageTypeBox-{tabId}" name="packageType-{tabId}" class="packageType" value="–∫–æ—Ä–æ–±">
                        <label for="packageTypeBox-{tabId}">–ö–æ—Ä–æ–±</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="packageTypePallet-{tabId}" name="packageType-{tabId}" class="packageType" value="–ø–∞–ª–ª–µ—Ç–∞">
                        <label for="packageTypePallet-{tabId}">–ü–∞–ª–ª–µ—Ç–∞</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="packageTypeMonopallet-{tabId}" name="packageType-{tabId}" class="packageType" value="–º–æ–Ω–æ–ø–∞–ª–ª–µ—Ç–∞">
                        <label for="packageTypeMonopallet-{tabId}">–ú–æ–Ω–æ–ø–∞–ª–ª–µ—Ç–∞</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="package_places-{tabId}">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–∑–æ–º–µ—Å—Ç:</label>
                <input type="number" id="package_places-{tabId}" class="package_places" min="1" required>
            </div>

            <div class="form-group box-count-field hidden">
                <label for="boxCount-{tabId}">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä–æ–±–æ–≤:</label>
                <input type="number" id="boxCount-{tabId}" class="boxCount" min="1">
            </div>
            
            <!-- –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ—Å—Ç–∞–≤–æ–∫ -->
            <div class="common-questions">
                <div class="form-group">
                    <label>–¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —É–ø–∞–∫–æ–≤–æ—á–Ω–æ–≥–æ –ª–∏—Å—Ç–∞?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="packingListNo-{tabId}" name="packingList-{tabId}" class="packingList" value="–Ω–µ—Ç" checked>
                            <label for="packingListNo-{tabId}">–ù–µ—Ç</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="packingListYes-{tabId}" name="packingList-{tabId}" class="packingList" value="–¥–∞">
                            <label for="packingListYes-{tabId}">–î–∞</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>–ù—É–∂–Ω–æ –ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —à—Ç—Ä–∏—Ö–∫–æ–¥—ã –Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="barcodeCheckNo-{tabId}" name="barcodeCheck-{tabId}" class="barcodeCheck" value="–Ω–µ—Ç" checked>
                            <label for="barcodeCheckNo-{tabId}">–ù–µ—Ç</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="barcodeCheckYes-{tabId}" name="barcodeCheck-{tabId}" class="barcodeCheck" value="–¥–∞">
                            <label for="barcodeCheckYes-{tabId}">–î–∞</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="cargoWeight-{tabId}">–û–±—â–∏–π –≤–µ—Å –≥—Ä—É–∑–∞ (–∫–≥):</label>
                    <input type="number" id="cargoWeight-{tabId}" class="cargoWeight" min="0" step="0.1" required>
                </div>
            </div>
            
            <!-- –ë–ª–æ–∫ –¥–ª—è –≤–∏–¥–∞ "–ö–æ—Ä–æ–±" -->
            <div class="package-box-details hidden">
                <div class="form-group">
                    <label>–¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—Ä–æ–±–æ–≤?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="boxMarkingNo-{tabId}" name="boxMarking-{tabId}" class="boxMarking" value="–Ω–µ—Ç" checked>
                            <label for="boxMarkingNo-{tabId}">–ù–µ—Ç</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="boxMarkingYes-{tabId}" name="boxMarking-{tabId}" class="boxMarking" value="–¥–∞">
                            <label for="boxMarkingYes-{tabId}">–î–∞</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ë–ª–æ–∫ –¥–ª—è –≤–∏–¥–∞ "–ü–∞–ª–ª–µ—Ç–∞" –∏–ª–∏ "–ú–æ–Ω–æ–ø–∞–ª–ª–µ—Ç–∞" -->
            <div class="package-pallet-details hidden">
                <div class="form-group">
                    <label>–í –∫–∞–∫–æ–º –≤–∏–¥–µ –ø—Ä–∏–±—É–¥–µ—Ç –≥—Ä—É–∑ –Ω–∞ —Å–∫–ª–∞–¥ NCG?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="cargoTypeReady-{tabId}" name="cargoArrivalType-{tabId}" class="cargoArrivalType" value="–≥–æ—Ç–æ–≤—ã–π –≤–∏–¥" checked>
                            <label for="cargoTypeReady-{tabId}">–ì–æ—Ç–æ–≤—ã–π –≤–∏–¥, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="cargoTypeBulk-{tabId}" name="cargoArrivalType-{tabId}" class="cargoArrivalType" value="—Ä–æ—Å—Å—ã–ø—å—é">
                            <label for="cargoTypeBulk-{tabId}">–†–æ—Å—Å—ã–ø—å—é</label>
                        </div>
                    </div>
                </div>
                
                <!-- –ë–ª–æ–∫ –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ "–†–æ—Å—Å—ã–ø—å—é" -->
                <div class="cargo-bulk-details hidden">
                    <div class="form-group">
                        <label>–¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—Ä–æ–±–æ–≤?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="bulkBoxMarkingNo-{tabId}" name="bulkBoxMarking-{tabId}" class="bulkBoxMarking" value="–Ω–µ—Ç" checked>
                                <label for="bulkBoxMarkingNo-{tabId}">–ù–µ—Ç</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="bulkBoxMarkingYes-{tabId}" name="bulkBoxMarking-{tabId}" class="bulkBoxMarking" value="–¥–∞">
                                <label for="bulkBoxMarkingYes-{tabId}">–î–∞</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–ü–∞–ª–ª–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="palletizationNo-{tabId}" name="palletization-{tabId}" class="palletization" value="–Ω–µ –Ω—É–∂–Ω–æ" checked>
                                <label for="palletizationNo-{tabId}">–ù–µ –Ω—É–∂–Ω–æ</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="palletizationOnly-{tabId}" name="palletization-{tabId}" class="palletization" value="—Ç–æ–ª—å–∫–æ –ø–∞–ª–ª–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ">
                                <label for="palletizationOnly-{tabId}">–ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–∞–ª–ª–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="palletizationWithPallet-{tabId}" name="palletization-{tabId}" class="palletization" value="–ø–æ–¥–¥–æ–Ω –∏ –ø–∞–ª–ª–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ">
                                <label for="palletizationWithPallet-{tabId}">–ù—É–∂–µ–Ω –ø–æ–¥–¥–æ–Ω –∏ –ø–∞–ª–ª–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label>–ù—É–∂–µ–Ω –ª–∏ –∑–∞–±–æ—Ä –≤–∞—à–µ–≥–æ –≥—Ä—É–∑–∞?</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="needPickupNo-{tabId}" name="needPickup-{tabId}" class="needPickup" value="–Ω–µ—Ç" checked>
                        <label for="needPickupNo-{tabId}">–ù–µ—Ç</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="needPickupYes-{tabId}" name="needPickup-{tabId}" class="needPickup" value="–¥–∞">
                        <label for="needPickupYes-{tabId}">–î–∞</label>
                    </div>
                </div>
                <div id="pickupWarning-{tabId}" class="pickup-warning hidden">
                    <p>–í–Ω–∏–º–∞–Ω–∏–µ: –∑–∞–±–æ—Ä—ã –Ω–∞—à–∏–º–∏ —Å–∏–ª–∞–º–∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è—é—Ç—Å—è –Ω–µ –º–µ–Ω–µ–µ, —á–µ–º –ó–ê –î–ï–ù–¨ –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥—Ä—É–∑–∞ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å - <strong>–∑–∞–±–æ—Ä—ã –¥–µ–Ω—å –≤ –¥–µ–Ω—å –ù–ï –ü–†–û–ò–ó–í–û–î–ò–ú!</strong></p>
                </div>
            </div>
            
            <div class="pickup-details hidden">
                <div class="form-group">
                    <label for="pickupAddress-{tabId}">–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞:</label>
                    <textarea id="pickupAddress-{tabId}" class="pickupAddress" rows="3" required disabled></textarea>
                </div>
                
                <div class="form-group">
                    <label>–í—Ä–µ–º–µ–Ω–Ω–æ–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –¥–ª—è –∑–∞–±–æ—Ä–∞:</label>
                    <div class="time-range">
                        <select id="pickupTimeFrom-{tabId}" class="pickupTimeFrom" required disabled>
                            <option value="">–°</option>
                            <option value="9:00">9:00</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="12:00">12:00</option>
                            <option value="13:00">13:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                        </select>
                        <span>–¥–æ</span>
                        <select id="pickupTimeTo-{tabId}" class="pickupTimeTo" required disabled>
                            <option value="">–î–æ</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="12:00">12:00</option>
                            <option value="13:00">13:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                            <option value="18:00">18:00</option>

                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="contactPhone-{tabId}">–¢–µ–ª–µ—Ñ–æ–Ω –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞:</label>
                    <input type="tel" id="contactPhone-{tabId}" class="contactPhone" placeholder="+7 (___) ___-__-__" required disabled>
                </div>
                
                <div class="form-group">
                    <label for="accessComment-{tabId}">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø—Ä–æ–µ–∑–¥—É:</label>
                    <textarea id="accessComment-{tabId}" class="accessComment" rows="3" placeholder="–£–∫–∞–∂–∏—Ç–µ –Ω—é–∞–Ω—Å—ã - –µ—Å—Ç—å –ª–∏ —à–ª–∞–≥–±–∞—É–º, –∫–∞–∫ –ø—Ä–æ–µ—Ö–∞—Ç—å, –ø—É–Ω–∫—Ç –æ—Ö—Ä–∞–Ω—ã, –Ω–æ–º–µ—Ä –¥–æ–º–æ—Ñ–æ–Ω–∞ –∏ —Ç.–¥." disabled></textarea>
                </div>
                
                <div class="form-group">
                    <label>–¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –ø–æ–º–æ—â—å –≤–æ–¥–∏—Ç–µ–ª—è?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="driverHelpNo-{tabId}" name="driverHelp-{tabId}" class="driverHelp" value="–Ω–µ—Ç" checked disabled>
                            <label for="driverHelpNo-{tabId}">–ù–µ—Ç</label>
                        </div>
                        <div class="radio-option">
                            
                            <input type="radio" id="driverHelpYes-{tabId}" name="driverHelp-{tabId}" class="driverHelp" value="–¥–∞" disabled>
                            <label for="driverHelpYes-{tabId}">–î–∞</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const SPREADSHEET_ID = '1u03UnXYIrPcF6yY87yetvcFvb14HlM6gQrSefMBjMWY';
        const WEBHOOK_URL = 'https://fulfillmentserver.ru/webhook/c997ca37-fee7-4752-aeb1-93a7ab515917';
        const MAX_TABS = 5;
        
        // DOM-—ç–ª–µ–º–µ–Ω—Ç—ã
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error');
        const tabsContainer = document.getElementById('tabsContainer');
        const tabsNav = document.getElementById('tabs');
        const addTabBtn = document.getElementById('addTabBtn');
        const cargoFormMain = document.getElementById('cargoFormMain');
        const formTemplate = document.getElementById('formTemplate');
        const submitButton = document.getElementById('submitButton');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const telegramUserInfo = document.getElementById('telegramUserInfo');
        const telegramUserId = document.getElementById('telegramUserId');
        const telegramUserName = document.getElementById('telegramUserName');
        const themeToggle = document.getElementById('themeToggle');
        
        // –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
        let tableData = [];
        let tabCounter = 1;
        let activeTabs = ['tab1'];
        let telegramData = null;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º—ã
        function setTheme(isDark) {
            if (isDark) {
                document.body.classList.remove('light-theme');
                document.body.classList.add('dark-theme');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-theme');
                document.body.classList.add('light-theme');
                localStorage.setItem('theme', 'light');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –º–∞—Ä–∫–µ—Ä–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã
            const slider = document.querySelector('.slider');
            if (slider) {
                setTimeout(() => {
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
                    slider.style.transition = '.4s';
                }, 50);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        themeToggle.addEventListener('change', function() {
            setTheme(this.checked);
        });
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø—Ä–æ—à–ª–æ –ª–∏ —É–∂–µ 12:00 –ø–æ –ú–°–ö
        function isPastNoonMSK() {
            // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –ø–æ –º–µ—Å—Ç–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏
            const now = new Date();
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –æ—Ç UTC –≤ –º–∏–Ω—É—Ç–∞—Ö
            const localOffset = now.getTimezoneOffset();
            
            // –í—ã—á–∏—Å–ª—è–µ–º –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è (UTC+3)
            const mskOffset = -180; // UTC+3 = -180 –º–∏–Ω—É—Ç
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω–∏—Ü—É –≤ –º–∏–Ω—É—Ç–∞—Ö –º–µ–∂–¥—É –º–µ—Å—Ç–Ω—ã–º –∏ –º–æ—Å–∫–æ–≤—Å–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º
            const offsetDiff = localOffset + mskOffset;
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –¥–∞—Ç—É —Å —É—á–µ—Ç–æ–º —Ä–∞–∑–Ω–∏—Ü—ã
            const mskTime = new Date(now.getTime() + offsetDiff * 60000);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±–æ–ª—å—à–µ –ª–∏ —á–∞—Å–æ–≤, —á–µ–º 12
            return mskTime.getHours() >= 12;
        }
        
        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY –∏–ª–∏ DD.MM.YY –≤ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD
        function parseDateString(dateStr) {
            // –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –¥–∞—Ç—ã
            const parts = dateStr.split('.');
            
            if (parts.length !== 3) {
                console.error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã:', dateStr);
                return null;
            }
            
            let day = parts[0];
            let month = parts[1];
            let year = parts[2];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≥–æ–¥ –¥–≤—É–∑–Ω–∞—á–Ω—ã–º
            if (year.length === 2) {
                // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –≥–æ–¥—ã 00-49 –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ 2000-2049, –∞ 50-99 –∫ 1950-1999
                year = year < 50 ? '20' + year : '19' + year;
            }
            
            // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –¥–µ–Ω—å –∏ –º–µ—Å—è—Ü –∏–º–µ—é—Ç –¥–≤–µ —Ü–∏—Ñ—Ä—ã
            day = day.padStart(2, '0');
            month = month.padStart(2, '0');
            
            return `${year}-${month}-${day}`;
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY
        function formatDateForDisplay(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${day}.${month}.${year}`;
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–Ω–µ–π –∫ –¥–∞—Ç–µ
        function addDays(dateStr, days) {
            const date = new Date(dateStr);
            date.setDate(date.getDate() + days);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // –í—ã—á–∏—Ç–∞–Ω–∏–µ –¥–Ω–µ–π –∏–∑ –¥–∞—Ç—ã
        function subtractDays(dateStr, days) {
            return addDays(dateStr, -days);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–µ—Ä–≤–∞—è –¥–∞—Ç–∞ —Ä–∞–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ–π –≤—Ç–æ—Ä–æ–π
        function isDateBeforeOrEqual(date1, date2) {
            const d1 = new Date(date1);
            const d2 = new Date(date2);
            return d1 <= d2;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        function initTelegramApp() {
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É –∏–ª–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ Telegram
            const savedTheme = localStorage.getItem('theme');
            let isDarkTheme = false;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º—ã Telegram
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —Ç–µ–º–Ω–∞—è –ª–∏ —Ç–µ–º–∞ –≤ Telegram
                isDarkTheme = tg.colorScheme === 'dark';
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
            if (savedTheme) {
                isDarkTheme = savedTheme === 'dark';
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è
            themeToggle.checked = isDarkTheme;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
            setTheme(isDarkTheme);
            
            // –†–∞—Å—à–∏—Ä—è–µ–º –¥–ª—è Telegram
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                
                // –†–∞—Å—à–∏—Ä—è–µ–º –æ–±–ª–∞—Å—Ç—å –¥–æ –ø–æ–ª–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
                tg.expand();
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                try {
                    // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                        telegramData = tg.initDataUnsafe.user;
                        
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                        telegramUserInfo.classList.remove('hidden');
                        telegramUserId.textContent = telegramData.id || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
                        telegramUserName.textContent = 
                            (telegramData.first_name || '') + 
                            (telegramData.last_name ? ' ' + telegramData.last_name : '');
                    } else {
                        console.warn('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
                        
                        // –§–∏–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ Telegram
                        telegramData = { id: 'test_user_123', first_name: 'Test', last_name: 'User' };
                        
                        // –í —Ä–µ–∂–∏–º–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏
                        telegramUserInfo.classList.remove('hidden');
                        telegramUserId.textContent = telegramData.id + ' (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)';
                        telegramUserName.textContent = telegramData.first_name + ' ' + telegramData.last_name;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö Telegram:', error);
                    
                    // –§–∏–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
                    telegramData = { id: 'error_user', first_name: 'Error', last_name: 'User' };
                    
                    telegramUserInfo.classList.remove('hidden');
                    telegramUserId.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å';
                    telegramUserName.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å';
                }
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–º–æ–π Telegram
                if (tg.MainButton) {
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ì–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram
                    tg.MainButton.setText('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É');
                    tg.MainButton.onClick(submitForm);
                    tg.MainButton.show();
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞—à—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É
                    submitButton.style.display = 'none';
                }
            } else {
                console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤–Ω–µ Telegram WebApp');
                
                // –§–∏–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ Telegram
                telegramData = { id: 'browser_user_456', first_name: 'Browser', last_name: 'User' };
                
                // –í —Ä–µ–∂–∏–º–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏
                telegramUserInfo.classList.remove('hidden');
                telegramUserId.textContent = telegramData.id + ' (–±—Ä–∞—É–∑–µ—Ä)';
                telegramUserName.textContent = telegramData.first_name + ' ' + telegramData.last_name;
                
                // –í –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É
                submitButton.style.display = 'block';
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets
        async function loadGoogleSheet() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
                const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ`;
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL:', url);
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø.');
                }
                
                const csvText = await response.text();
                console.log('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ CSV:', csvText);
                
                // –ü–∞—Ä—Å–∏–Ω–≥ CSV
                const rows = csvText.split('\n').map(row => {
                    // –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –Ω–∞ —è—á–µ–π–∫–∏, —É—á–∏—Ç—ã–≤–∞—è –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
                    const cells = [];
                    let inQuotes = false;
                    let currentCell = '';
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        
                        if (char === '"' && (i === 0 || row[i-1] !== '\\')) {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            cells.push(currentCell.replace(/""/g, '"'));
                            currentCell = '';
                        } else {
                            currentCell += char;
                        }
                    }
                    cells.push(currentCell.replace(/""/g, '"').replace(/^"|"$/g, ''));
                    
                    return cells;
                });
                
                console.log('–†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏:', rows);
                
                // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ - –∑–∞–≥–æ–ª–æ–≤–∫–∏
                const headers = rows[0];
                console.log('–ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã:', headers);
                
                // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å—ã –Ω—É–∂–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤
                const colIndices = {
                    branch: headers.findIndex(h => h.includes('–∏–ª–∏–∞–ª')),
                    marketplace: headers.findIndex(h => h.includes('–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å')),
                    city: headers.findIndex(h => h.includes('–æ—Ä–æ–¥')),
                    warehouse: headers.findIndex(h => h.includes('–∫–ª–∞–¥')),
                    address: headers.findIndex(h => h.includes('–¥—Ä–µ—Å')),
                    leadDays: 6, // –ù–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü G —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–Ω–µ–π –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏
                    date1: 7,    // –°—Ç–æ–ª–±–µ—Ü H —Å –¥–∞—Ç–æ–π 1
                    date2: 8,    // –°—Ç–æ–ª–±–µ—Ü I —Å –¥–∞—Ç–æ–π 2
                    date3: 9,    // –°—Ç–æ–ª–±–µ—Ü J —Å –¥–∞—Ç–æ–π 3
                    date4: 10,   // –°—Ç–æ–ª–±–µ—Ü K —Å –¥–∞—Ç–æ–π 4
                    date5: 11,   // –°—Ç–æ–ª–±–µ—Ü L —Å –¥–∞—Ç–æ–π 5
                    date6: 12,   // –°—Ç–æ–ª–±–µ—Ü M —Å –¥–∞—Ç–æ–π 6
                    date7: 13,   // –°—Ç–æ–ª–±–µ—Ü N —Å –¥–∞—Ç–æ–π 7
                    date8: 14,   // –°—Ç–æ–ª–±–µ—Ü O —Å –¥–∞—Ç–æ–π 8
                    date9: 15,   // –°—Ç–æ–ª–±–µ—Ü P —Å –¥–∞—Ç–æ–π 9
                    date10: 16,  // –°—Ç–æ–ª–±–µ—Ü Q —Å –¥–∞—Ç–æ–π 10
                    date11: 17,  // –°—Ç–æ–ª–±–µ—Ü R —Å –¥–∞—Ç–æ–π 11
                    date12: 18   // –°—Ç–æ–ª–±–µ—Ü S —Å –¥–∞—Ç–æ–π 12
                };
                
                console.log('–ò–Ω–¥–µ–∫—Å—ã —Å—Ç–æ–ª–±—Ü–æ–≤:', colIndices);
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —É–¥–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                tableData = rows.slice(1).map(row => ({
                    branch: row[colIndices.branch],
                    marketplace: row[colIndices.marketplace],
                    city: row[colIndices.city],
                    warehouse: row[colIndices.warehouse],
                    address: row[colIndices.address],
                    leadDays: parseInt(row[colIndices.leadDays]) || 0,
                    date1: row[colIndices.date1],
                    date2: row[colIndices.date2],
                    date3: row[colIndices.date3],
                    date4: row[colIndices.date4],
                    date5: row[colIndices.date5],
                    date6: row[colIndices.date6],
                    date7: row[colIndices.date7],
                    date8: row[colIndices.date8],
                    date9: row[colIndices.date9],
                    date10: row[colIndices.date10],
                    date11: row[colIndices.date11],
                    date12: row[colIndices.date12]
                })).filter(row => row.branch && row.marketplace && row.city && row.warehouse); // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                
                console.log('–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', tableData);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞—Ç –≤ –¥–∞–Ω–Ω—ã—Ö
                const hasDates = tableData.some(row => 
                    row.date1.trim() || row.date2.trim() || row.date3.trim() || 
                    row.date4.trim() || row.date5.trim() || row.date6.trim() ||
                    row.date7.trim() || row.date8.trim() || row.date9.trim() ||
                    row.date10.trim() || row.date11.trim() || row.date12.trim()
                );
                
                if (!hasDates) {
                    console.warn('–í —Ç–∞–±–ª–∏—Ü–µ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏');
                    errorDiv.classList.remove('hidden');
                    errorDiv.textContent = '–í —Ç–∞–±–ª–∏—Ü–µ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ.';
                    return;
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–∏
                initTab('tab1');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∏ —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                loadingDiv.style.display = 'none';
                tabsContainer.classList.remove('hidden');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ì–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram, –µ—Å–ª–∏ —ç—Ç–æ Telegram WebApp
                if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.MainButton) {
                    window.Telegram.WebApp.MainButton.show();
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                loadingDiv.style.display = 'none';
                errorDiv.classList.remove('hidden');
                errorDiv.textContent = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`;
            }
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —É—á–µ—Ç–æ–º –Ω–∞–ª–∏—á–∏—è –¥–∞—Ç
        function filterDataWithDates(data) {
            return data.filter(item => 
                item.date1.trim() || item.date2.trim() || item.date3.trim() || 
                item.date4.trim() || item.date5.trim() || item.date6.trim() ||
                item.date7.trim() || item.date8.trim() || item.date9.trim() ||
                item.date10.trim() || item.date11.trim() || item.date12.trim()
            );
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏
        function initTab(tabId) {
            const tabContent = document.getElementById(tabId);
            
            // –ï—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–æ
            if (!tabContent.querySelector('.form-content')) {
                // –ö–ª–æ–Ω–∏—Ä—É–µ–º —à–∞–±–ª–æ–Ω —Ñ–æ—Ä–º—ã
                const content = formTemplate.content.cloneNode(true);
                
                // –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä {tabId} –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π id –≤–∫–ª–∞–¥–∫–∏ –≤–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
                const tabIdNum = tabId.replace('tab', '');
                content.querySelectorAll('[id$="-{tabId}"]').forEach(el => {
                    el.id = el.id.replace('{tabId}', tabIdNum);
                });
                content.querySelectorAll('[name$="-{tabId}"]').forEach(el => {
                    el.name = el.name.replace('{tabId}', tabIdNum);
                });
                content.querySelectorAll('[for$="-{tabId}"]').forEach(el => {
                    el.setAttribute('for', el.getAttribute('for').replace('{tabId}', tabIdNum));
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ –≤–∫–ª–∞–¥–∫—É
                tabContent.appendChild(content);
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç —Ñ–∏–ª–∏–∞–ª–æ–≤
                populateBranches(tabIdNum);
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                setEventHandlers(tabIdNum);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫, –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–π
                if (tabIdNum > 1) {
                    const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
                    if (tabElement) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
                        const closeButton = document.createElement('span');
                        closeButton.className = 'tab-close';
                        closeButton.innerHTML = '√ó';
                        closeButton.title = '–ó–∞–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É';
                        closeButton.onclick = function(e) {
                            e.stopPropagation(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫
                            closeTab(tabId);
                        };
                        tabElement.appendChild(closeButton);
                    }
                }
            }
        }
        
        // –ü–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
        function renumberTabs() {
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É DOM
            const tabElements = Array.from(document.querySelectorAll('.tab:not(#addTabBtn)'));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤–∫–ª–∞–¥–æ–∫
            tabElements.forEach((tabElement, index) => {
                const tabNumber = index + 1;
                tabElement.textContent = `–ó–∞–∫–∞–∑ ${tabNumber}`;
                
                // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–µ—Ä–≤–∞—è –≤–∫–ª–∞–¥–∫–∞, –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
                if (tabNumber > 1) {
                    const closeButton = document.createElement('span');
                    closeButton.className = 'tab-close';
                    closeButton.innerHTML = '√ó';
                    closeButton.title = '–ó–∞–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É';
                    const tabId = tabElement.dataset.tabId;
                    closeButton.onclick = function(e) {
                        e.stopPropagation();
                        closeTab(tabId);
                    };
                    tabElement.appendChild(closeButton);
                }
            });
        }
        
        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–∞ —Ñ–∏–ª–∏–∞–ª–æ–≤
        function populateBranches(tabIdNum) {
            const branchSelect = document.getElementById(`branch-${tabIdNum}`);
            
            // –û—á–∏—â–∞–µ–º —Å–µ–ª–µ–∫—Ç
            branchSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª–∏–∞–ª</option>';
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –Ω–∞–ª–∏—á–∏—é –¥–∞—Ç
            const validData = filterDataWithDates(tableData);
            
            if (validData.length === 0) {
                errorDiv.classList.remove('hidden');
                errorDiv.textContent = '–í —Ç–∞–±–ª–∏—Ü–µ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏.';
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–∏–ª–∏–∞–ª—ã
            const branches = [...new Set(validData.map(item => item.branch))].filter(Boolean);
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç —Ñ–∏–ª–∏–∞–ª–æ–≤
            branches.forEach(branch => {
                const option = document.createElement('option');
                option.value = branch;
                option.textContent = branch;
                branchSelect.appendChild(option);
            });
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–∫–ª–∞–¥–∫–∏
        function setEventHandlers(tabIdNum) {
            // –°–µ–ª–µ–∫—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª–µ–π
            const branchSelect = document.getElementById(`branch-${tabIdNum}`);
            const marketplaceSelect = document.getElementById(`marketplace-${tabIdNum}`);
            const citySelect = document.getElementById(`city-${tabIdNum}`);
            const warehouseSelect = document.getElementById(`warehouse-${tabIdNum}`);
            const marketplaceShipmentDateSelect = document.getElementById(`marketplaceShipmentDate-${tabIdNum}`);
            const ncgShipmentDateSelect = document.getElementById(`ncgShipmentDate-${tabIdNum}`);
            const addressDisplay = document.getElementById(`address-${tabIdNum}`);
            
            // –†–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–∏–ø–∞ —É–ø–∞–∫–æ–≤–∫–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –±–ª–æ–∫–∏
            const packageTypeRadios = document.querySelectorAll(`[name="packageType-${tabIdNum}"]`);
            const packageBoxDetails = document.querySelector(`#tab${tabIdNum} .package-box-details`);
            const packagePalletDetails = document.querySelector(`#tab${tabIdNum} .package-pallet-details`);
            
            // –†–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤–∏–¥–∞ –ø—Ä–∏–±—ã—Ç–∏—è –≥—Ä—É–∑–∞ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            const cargoArrivalTypeRadios = document.querySelectorAll(`[name="cargoArrivalType-${tabIdNum}"]`);
            const cargoBulkDetails = document.querySelector(`#tab${tabIdNum} .cargo-bulk-details`);
            
            // –†–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ –∏ –ø–æ–ª—è –¥–ª—è –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞
            const needPickupRadios = document.querySelectorAll(`[name="needPickup-${tabIdNum}"]`);
            const pickupDetails = document.querySelector(`#tab${tabIdNum} .pickup-details`);
            const pickupAddress = document.getElementById(`pickupAddress-${tabIdNum}`);
            const pickupTimeFrom = document.getElementById(`pickupTimeFrom-${tabIdNum}`);
            const pickupTimeTo = document.getElementById(`pickupTimeTo-${tabIdNum}`);
            const contactPhone = document.getElementById(`contactPhone-${tabIdNum}`);
            const accessComment = document.getElementById(`accessComment-${tabIdNum}`);
            const cargoWeight = document.getElementById(`cargoWeight-${tabIdNum}`);
            const driverHelpRadios = document.querySelectorAll(`[name="driverHelp-${tabIdNum}"]`);
            
            // –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É–ø–∞–∫–æ–≤–∫–∏
            const packingListRadios = document.querySelectorAll(`[name="packingList-${tabIdNum}"]`);
            const barcodeCheckRadios = document.querySelectorAll(`[name="barcodeCheck-${tabIdNum}"]`);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∏–ª–∏–∞–ª–∞
            branchSelect.addEventListener('change', function() {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–ª–µ–∫—Ç—ã
                resetSelect(marketplaceSelect, '–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å');
                resetSelect(citySelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å');
                resetSelect(warehouseSelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥');
                resetSelect(marketplaceShipmentDateSelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∫–ª–∞–¥');
                resetSelect(ncgShipmentDateSelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å');
                addressDisplay.textContent = '–ê–¥—Ä–µ—Å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å–∫–ª–∞–¥–∞';
                
                const selectedBranch = this.value;
                
                if (!selectedBranch) {
                    marketplaceSelect.disabled = true;
                    return;
                }
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
                const validData = filterDataWithDates(tableData);
                const marketplaces = [...new Set(
                    validData
                        .filter(item => item.branch === selectedBranch)
                        .map(item => item.marketplace)
                )].filter(Boolean);
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
                marketplaces.forEach(marketplace => {
                    const option = document.createElement('option');
                    option.value = marketplace;
                    option.textContent = marketplace;
                    marketplaceSelect.appendChild(option);
                });
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
                marketplaceSelect.disabled = false;
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
            marketplaceSelect.addEventListener('change', function() {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–ª–µ–∫—Ç—ã
                resetSelect(citySelect, '–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥');
                resetSelect(warehouseSelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥');
                resetSelect(marketplaceShipmentDateSelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∫–ª–∞–¥');
                resetSelect(ncgShipmentDateSelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å');
                addressDisplay.textContent = '–ê–¥—Ä–µ—Å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å–∫–ª–∞–¥–∞';
                
                const selectedBranch = branchSelect.value;
                const selectedMarketplace = this.value;
                
                if (!selectedMarketplace) {
                    citySelect.disabled = true;
                    return;
                }
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º –≥–æ—Ä–æ–¥–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞ –∏ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
                const validData = filterDataWithDates(tableData);
                const cities = [...new Set(
                    validData
                        .filter(item => 
                            item.branch === selectedBranch && 
                            item.marketplace === selectedMarketplace
                        )
                        .map(item => item.city)
                )].filter(Boolean);
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç –≥–æ—Ä–æ–¥–æ–≤
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç –≥–æ—Ä–æ–¥–æ–≤
                citySelect.disabled = false;
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞
            citySelect.addEventListener('change', function() {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–ª–µ–∫—Ç—ã
                resetSelect(warehouseSelect, '–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–ª–∞–¥');
                resetSelect(marketplaceShipmentDateSelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∫–ª–∞–¥');
                resetSelect(ncgShipmentDateSelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å');
                addressDisplay.textContent = '–ê–¥—Ä–µ—Å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å–∫–ª–∞–¥–∞';
                
                const selectedBranch = branchSelect.value;
                const selectedMarketplace = marketplaceSelect.value;
                const selectedCity = this.value;
                
                if (!selectedCity) {
                    warehouseSelect.disabled = true;
                    return;
                }
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–∫–ª–∞–¥—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞, –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ –∏ –≥–æ—Ä–æ–¥–∞
                const validData = filterDataWithDates(tableData);
                const warehouses = [...new Set(
                    validData
                        .filter(item => 
                            item.branch === selectedBranch && 
                            item.marketplace === selectedMarketplace && 
                            item.city === selectedCity
                        )
                        .map(item => item.warehouse)
                )].filter(Boolean);
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç —Å–∫–ª–∞–¥–æ–≤
                warehouses.forEach(warehouse => {
                    const option = document.createElement('option');
                    option.value = warehouse;
                    option.textContent = warehouse;
                    warehouseSelect.appendChild(option);
                });
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç —Å–∫–ª–∞–¥–æ–≤
                warehouseSelect.disabled = false;
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Å–∫–ª–∞–¥–∞ - –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç
            warehouseSelect.addEventListener('change', function() {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç –¥–∞—Ç—ã
                resetSelect(marketplaceShipmentDateSelect, '–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å');
                resetSelect(ncgShipmentDateSelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å');
                
                const selectedBranch = branchSelect.value;
                const selectedMarketplace = marketplaceSelect.value;
                const selectedCity = citySelect.value;
                const selectedWarehouse = this.value;
                
                if (!selectedWarehouse) {
                    marketplaceShipmentDateSelect.disabled = true;
                    addressDisplay.textContent = '–ê–¥—Ä–µ—Å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å–∫–ª–∞–¥–∞';
                    return;
                }
                
                // –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â—É—é –∑–∞–ø–∏—Å—å –≤ –¥–∞–Ω–Ω—ã—Ö
                const validData = filterDataWithDates(tableData);
                const selectedItem = validData.find(item => 
                    item.branch === selectedBranch && 
                    item.marketplace === selectedMarketplace && 
                    item.city === selectedCity &&
                    item.warehouse === selectedWarehouse
                );
                
                if (!selectedItem) {
                    addressDisplay.textContent = '–ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤';
                    return;
                }
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–¥—Ä–µ—Å —Å–∫–ª–∞–¥–∞
                addressDisplay.textContent = selectedItem.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω';
                
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ (leadDays)
                const leadDays = selectedItem.leadDays || 0;
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è
                const today = getTodayDate();
                const isPastNoon = isPastNoonMSK();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å
                const dates = [];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –¥–∞—Ç—É –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å —É—á–µ—Ç–æ–º leadDays
                // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                console.log("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏:", leadDays);
                console.log("–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞:", today);
                console.log("–ü—Ä–æ—à–ª–æ 12:00 –ú–°–ö:", isPastNoon);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –¥–∞—Ç—ã –¥–æ date12
                for (let i = 1; i <= 12; i++) {
                    const dateCol = `date${i}`;
                    const dateValue = selectedItem[dateCol];
                    if (dateValue && dateValue.trim() !== '') {
                        const date = parseDateString(dateValue);
                        if (date && date >= today) {
                            dates.push({ value: dateCol, text: formatDateForDisplay(date) });
                        }
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                if (dates.length === 0) {
                    marketplaceShipmentDateSelect.innerHTML = '';
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç –æ—Ç–≥—Ä—É–∑–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∫–ª–∞–¥–∞';
                    marketplaceShipmentDateSelect.appendChild(option);
                    marketplaceShipmentDateSelect.disabled = true;
                    return;
                }
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç –¥–∞—Ç –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å
                dates.forEach(date => {
                    const option = document.createElement('option');
                    option.value = date.value;
                    option.textContent = date.text;
                    option.dataset.rawDate = date.text; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –¥–∞—Ç—É –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
                    marketplaceShipmentDateSelect.appendChild(option);
                });
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç –¥–∞—Ç –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å
                marketplaceShipmentDateSelect.disabled = false;
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å
            marketplaceShipmentDateSelect.addEventListener('change', function() {
                const selectedDate = this.value;
                if (!selectedDate) {
                    resetSelect(ncgShipmentDateSelect, '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å');
                    ncgShipmentDateSelect.disabled = true;
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
                const selectedOption = this.options[this.selectedIndex];
                const marketplaceShipmentDateText = selectedOption.textContent;
                
                // –û—á–∏—â–∞–µ–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç –¥–ª—è –¥–∞—Ç—ã –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥ NCG
                ncgShipmentDateSelect.innerHTML = '';
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –æ—Ç–≥—Ä—É–∑–∫–∏ –∫ –Ω–∞–º –Ω–∞ —Å–∫–ª–∞–¥ NCG';
                ncgShipmentDateSelect.appendChild(defaultOption);
                
                // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Å–µ–ª–µ–∫—Ç–æ–≤
                const selectedMarketplace = marketplaceSelect.value;
                const selectedCity = citySelect.value;
                const selectedWarehouse = warehouseSelect.value;
                
                // –ü–æ–∏—Å–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ tableData
                const selectedItem = tableData.find(item => 
                    item.marketplace === selectedMarketplace && 
                    item.city === selectedCity &&
                    item.warehouse === selectedWarehouse
                );
                
                if (!selectedItem) {
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ (leadDays)
                const leadDays = selectedItem.leadDays || 0;
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ DD.MM.YYYY –∏–ª–∏ DD.MM.YY –≤ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD
                const marketplaceShipmentDateISO = parseDateString(marketplaceShipmentDateText);
                
                // –í—ã—á–∏—Å–ª—è–µ–º –∫—Ä–∞–π–Ω—é—é –¥–∞—Ç—É –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥ NCG (–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å - leadDays)
                const latestNcgShipmentDate = subtractDays(marketplaceShipmentDateISO, leadDays);
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
                const today = getTodayDate();
                const isPastNoon = isPastNoonMSK();
                
                // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç –¥–ª—è –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥ NCG
                const ncgShipmentDates = [];
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é –¥–∞—Ç—É (—Å–µ–≥–æ–¥–Ω—è)
                let currentDate = new Date(today);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É (–∫—Ä–∞–π–Ω—è—è –¥–∞—Ç–∞ –æ—Ç–≥—Ä—É–∑–∫–∏)
                const lastDate = new Date(latestNcgShipmentDate);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –∫—Ä–∞–π–Ω—è—è –¥–∞—Ç–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –∏ —É–∂–µ –ø–æ—Å–ª–µ 12:00
                if (latestNcgShipmentDate === today && isPastNoon) {
                    ncgShipmentDateSelect.innerHTML = '';
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = '–í—Ä–µ–º—è –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è —É–∂–µ –∏—Å—Ç–µ–∫–ª–æ (–ø–æ—Å–ª–µ 12:00 –ú–°–ö)';
                    ncgShipmentDateSelect.appendChild(option);
                    ncgShipmentDateSelect.disabled = true;
                    return;
                }
                
                // –ï—Å–ª–∏ –∫—Ä–∞–π–Ω—è—è –¥–∞—Ç–∞ —Ä–∞–Ω—å—à–µ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
                if (lastDate < currentDate) {
                    ncgShipmentDateSelect.innerHTML = '';
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = '–ö—Ä–∞–π–Ω–∏–π —Å—Ä–æ–∫ –æ—Ç–≥—Ä—É–∑–∫–∏ —É–∂–µ –ø—Ä–æ—à–µ–ª';
                    ncgShipmentDateSelect.appendChild(option);
                    ncgShipmentDateSelect.disabled = true;
                    return;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –¥–∞—Ç—ã –æ—Ç —Å–µ–≥–æ–¥–Ω—è –¥–æ –∫—Ä–∞–π–Ω–µ–π –¥–∞—Ç—ã –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥ NCG
                while (currentDate <= lastDate) {
                    const dateStr = currentDate.toISOString().split('T')[0];
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–∞—Ç–∞ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ–º (0 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 6 - —Å—É–±–±–æ—Ç–∞)
                    const dayOfWeek = currentDate.getDay();
                    
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è
                    if (dayOfWeek !== 0) {
                    // –ï—Å–ª–∏ —ç—Ç–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞ –∏ –∫—Ä–∞–π–Ω—è—è –¥–∞—Ç–∞, –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–º–µ—Ç–∫—É "–¥–æ 12:00 –ú–°–ö"
                    if (dateStr === today && dateStr === latestNcgShipmentDate) {
                        ncgShipmentDates.push({
                            value: dateStr,
                            text: formatDateForDisplay(dateStr) + " (–¥–æ 12:00 –ú–°–ö)"
                        });
                    } else {
                        ncgShipmentDates.push({
                            value: dateStr,
                            text: formatDateForDisplay(dateStr)
                        });
                        }
                    }
                    
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç –¥–∞—Ç –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥ NCG
                ncgShipmentDates.forEach(date => {
                    const option = document.createElement('option');
                    option.value = date.value;
                    option.textContent = date.text;
                    ncgShipmentDateSelect.appendChild(option);
                });
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç –¥–∞—Ç –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥ NCG
                ncgShipmentDateSelect.disabled = false;
                
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞ –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥ NCG, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–∞—Ç
                if (ncgShipmentDateSelect.selectedIndex > 0) {
                    const changeEvent = new Event('change');
                    ncgShipmentDateSelect.dispatchEvent(changeEvent);
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥ NCG
            ncgShipmentDateSelect.addEventListener('change', function() {
                const selectedDate = this.value;
                if (!selectedDate) {
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã –¥–ª—è —Å–∫–ª–∞–¥–∞ NCG (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞)
                const ncgDateText = this.options[this.selectedIndex].textContent.split(' ')[0]; // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–∞—Ç—É, –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞)
                const marketplaceSelect = marketplaceShipmentDateSelect;
                let marketplaceDateText = '';
                if (marketplaceSelect.selectedIndex > 0) {
                    marketplaceDateText = marketplaceSelect.options[marketplaceSelect.selectedIndex].textContent.split(' ')[0];
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–≤–ø–∞–¥–∞—é—Ç –ª–∏ –¥–∞—Ç—ã
                const datesMatch = marketplaceDateText && ncgDateText && marketplaceDateText === ncgDateText;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–∞—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞
                const ncgDateWarning = document.getElementById(`ncg-date-warning-${tabIdNum}`);
                if (ncgDateWarning) {
                    ncgDateWarning.style.display = 'block';
                }
                
                // –ï—Å–ª–∏ –¥–∞—Ç—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç, –±–ª–æ–∫–∏—Ä—É–µ–º –æ–ø—Ü–∏—é "–¥–∞" –¥–ª—è –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞
                const needPickupYes = document.getElementById(`needPickupYes-${tabIdNum}`);
                const needPickupNo = document.getElementById(`needPickupNo-${tabIdNum}`);
                
                if (datesMatch) {
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º –æ–ø—Ü–∏—é "–¥–∞" –∏ –≤—ã–±–∏—Ä–∞–µ–º "–Ω–µ—Ç"
                    needPickupYes.disabled = true;
                    needPickupNo.checked = true;
                    
                    // –ò–º–∏—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ change, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞
                    const changeEvent = new Event('change');
                    needPickupNo.dispatchEvent(changeEvent);
                    
                    // –î–æ–±–∞–≤–∏–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–±–æ—Ä–∞
                    let pickupWarning = document.getElementById(`sameday-pickup-warning-${tabIdNum}`);
                    if (!pickupWarning) {
                        pickupWarning = document.createElement('div');
                        pickupWarning.id = `sameday-pickup-warning-${tabIdNum}`;
                        pickupWarning.className = 'warning-message';
                        const needPickupGroup = needPickupYes.closest('.form-group');
                        needPickupGroup.appendChild(pickupWarning);
                    }
                    pickupWarning.style.display = 'block';
                    pickupWarning.innerHTML = '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –¥–µ–Ω—å –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å<br><br><strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –∑–∞–±–æ—Ä—ã –Ω–∞—à–∏–º–∏ —Å–∏–ª–∞–º–∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è—é—Ç—Å—è –Ω–µ –º–µ–Ω–µ–µ, —á–µ–º –ó–ê –î–ï–ù–¨ –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥—Ä—É–∑–∞ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å - –∑–∞–±–æ—Ä—ã –¥–µ–Ω—å –≤ –¥–µ–Ω—å –ù–ï –ü–†–û–ò–ó–í–û–î–ò–ú!';
                } else {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π
                    const today = getTodayDate();
                    const todayFormatted = formatDateForDisplay(today);
                    const isToday = ncgDateText === todayFormatted;
                    
                    if (isToday) {
                        // –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è, —Ç–∞–∫–∂–µ –±–ª–æ–∫–∏—Ä—É–µ–º
                        needPickupYes.disabled = true;
                        needPickupNo.checked = true;
                        
                        // –ò–º–∏—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ change
                        const changeEvent = new Event('change');
                        needPickupNo.dispatchEvent(changeEvent);
                        
                        // –î–æ–±–∞–≤–∏–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç–µ
                        let pickupWarning = document.getElementById(`sameday-pickup-warning-${tabIdNum}`);
                        if (!pickupWarning) {
                            pickupWarning = document.createElement('div');
                            pickupWarning.id = `sameday-pickup-warning-${tabIdNum}`;
                            pickupWarning.className = 'warning-message';
                            const needPickupGroup = needPickupYes.closest('.form-group');
                            needPickupGroup.appendChild(pickupWarning);
                        }
                        pickupWarning.style.display = 'block';
                        pickupWarning.textContent = '–ó–∞–±–æ—Ä –≥—Ä—É–∑–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                    } else {
                        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –æ–ø—Ü–∏—é "–¥–∞"
                        needPickupYes.disabled = false;
                        
                        // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
                        const pickupWarning = document.getElementById(`sameday-pickup-warning-${tabIdNum}`);
                        if (pickupWarning) {
                            pickupWarning.style.display = 'none';
                        }
                    }
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–∞—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å
            marketplaceShipmentDateSelect.addEventListener('change', function() {
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞ –æ—Ç–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥ NCG, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                if (ncgShipmentDateSelect.selectedIndex > 0) {
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
                    const marketplaceDateText = this.options[this.selectedIndex].textContent.split(' ')[0];
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã –¥–ª—è —Å–∫–ª–∞–¥–∞ NCG
                    const ncgDateText = ncgShipmentDateSelect.options[ncgShipmentDateSelect.selectedIndex].textContent.split(' ')[0];
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–∞—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                    const datesMatch = marketplaceDateText && ncgDateText && marketplaceDateText === ncgDateText;
                    const ncgDateWarning = document.getElementById(`ncg-date-warning-${tabIdNum}`);
                    
                    if (datesMatch && ncgDateWarning) {
                        ncgDateWarning.style.display = 'block';
                    } else if (ncgDateWarning) {
                        ncgDateWarning.style.display = 'none';
                    }
                    
                    // –ò–º–∏—Ç–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã NCG –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∑–∞–±–æ—Ä–∞
                    const changeEvent = new Event('change');
                    ncgShipmentDateSelect.dispatchEvent(changeEvent);
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —É–ø–∞–∫–æ–≤–∫–∏
            packageTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏
                    packageBoxDetails.classList.add('hidden');
                    packagePalletDetails.classList.add('hidden');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ—Ä–æ–±–æ–≤
                    const boxCountField = document.querySelector(`#tab${tabIdNum} .box-count-field`);
                    if (this.value === "–ø–∞–ª–ª–µ—Ç–∞" || this.value === "–º–æ–Ω–æ–ø–∞–ª–ª–µ—Ç–∞") {
                        boxCountField.classList.remove('hidden');
                        document.getElementById(`boxCount-${tabIdNum}`).required = true;
                    } else {
                        boxCountField.classList.add('hidden');
                        document.getElementById(`boxCount-${tabIdNum}`).required = false;
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
                    if (this.value === "–∫–æ—Ä–æ–±") {
                        packageBoxDetails.classList.remove('hidden');
                    } else if (this.value === "–ø–∞–ª–ª–µ—Ç–∞" || this.value === "–º–æ–Ω–æ–ø–∞–ª–ª–µ—Ç–∞") {
                        packagePalletDetails.classList.remove('hidden');
                    }
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –æ–ø—Ü–∏–∏ "–í –∫–∞–∫–æ–º –≤–∏–¥–µ –≥—Ä—É–∑ –ø—Ä–∏–±—É–¥–µ—Ç"
            cargoArrivalTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === "—Ä–æ—Å—Å—ã–ø—å—é") {
                        cargoBulkDetails.classList.remove('hidden');
                    } else {
                        cargoBulkDetails.classList.add('hidden');
                    }
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –æ–ø—Ü–∏–∏ "–ù—É–∂–µ–Ω –ª–∏ –∑–∞–±–æ—Ä –≥—Ä—É–∑–∞"
            needPickupRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const pickupWarning = document.getElementById(`pickupWarning-${tabIdNum}`);
                    
                    if (this.value === "–¥–∞") {
                        pickupDetails.classList.remove('hidden');
                        pickupAddress.disabled = false;
                        pickupTimeFrom.disabled = false;
                        pickupTimeTo.disabled = false;
                        contactPhone.disabled = false;
                        accessComment.disabled = false;
                        driverHelpRadios.forEach(radio => radio.disabled = false);
                        pickupWarning.classList.remove('hidden');
                        
                        pickupAddress.required = true;
                        pickupTimeFrom.required = true;
                        pickupTimeTo.required = true;
                        contactPhone.required = true;
                    } else {
                        pickupDetails.classList.add('hidden');
                        pickupAddress.disabled = true;
                        pickupTimeFrom.disabled = true;
                        pickupTimeTo.disabled = true;
                        contactPhone.disabled = true;
                        accessComment.disabled = true;
                        driverHelpRadios.forEach(radio => radio.disabled = true);
                        pickupWarning.classList.add('hidden');
                        
                        pickupAddress.required = false;
                        pickupTimeFrom.required = false;
                        pickupTimeTo.required = false;
                        contactPhone.required = false;
                    }
                });
            });
            
           // –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –±–µ–∑ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
contactPhone.addEventListener('input', function(e) {
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ + –≤ –Ω–∞—á–∞–ª–µ
    let value = this.value;
    
    // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å +, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ
    if (value.startsWith('+')) {
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ +
        value = '+' + value.substring(1).replace(/[^\d]/g, '');
    } else {
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
        value = value.replace(/[^\d]/g, '');
        
        // –ï—Å–ª–∏ –µ—Å—Ç—å —Ü–∏—Ñ—Ä—ã, –¥–æ–±–∞–≤–ª—è–µ–º +
        if (value.length > 0) {
            value = '+' + value;
        }
    }
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –Ω–æ–º–µ—Ä–∞
    if (value.length > 16) { // +15 —Ü–∏—Ñ—Ä –º–∞–∫—Å–∏–º—É–º
        value = value.substring(0, 16);
    }
    
    this.value = value;
});
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ "—Å"
            pickupTimeFrom.addEventListener('change', function() {
                // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è "—Å"
                const fromTime = this.value;
                
                if (!fromTime) {
                    return;
                }
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç –≤—Ä–µ–º–µ–Ω–∏ "–¥–æ"
                resetSelect(pickupTimeTo, '–î–æ');
                
                // –ü–æ–ª—É—á–∞–µ–º —á–∞—Å—ã –∏–∑ –≤—Ä–µ–º–µ–Ω–∏ "—Å"
                const fromHour = parseInt(fromTime.split(':')[0]);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ "–¥–æ", –Ω–∞—á–∏–Ω–∞—è —Å —á–∞—Å–∞ –ø–æ—Å–ª–µ –≤—Ä–µ–º–µ–Ω–∏ "—Å"
                for (let hour = fromHour + 1; hour <= 19; hour++) {
                    const timeStr = `${hour}:00`;
                    const option = document.createElement('option');
                    option.value = timeStr;
                    option.textContent = timeStr;
                    pickupTimeTo.appendChild(option);
                }
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç –≤—Ä–µ–º–µ–Ω–∏ "–¥–æ"
                pickupTimeTo.disabled = false;
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å–µ–ª–µ–∫—Ç–∞
        function resetSelect(select, placeholderText) {
            select.innerHTML = '';
            const placeholder = document.createElement('option');
            placeholder.value = '';
            placeholder.textContent = placeholderText;
            select.appendChild(placeholder);
            select.disabled = true;
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–∏
        function addTab() {
            if (activeTabs.length >= MAX_TABS) {
                alert(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ (${MAX_TABS})`);
                return;
            }
            
            // –ù–æ–≤—ã–π –Ω–æ–º–µ—Ä –≤–∫–ª–∞–¥–∫–∏ —Ä–∞–≤–µ–Ω –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫ + 1
            const newTabNum = activeTabs.length + 1;
            const newTabId = `tab${newTabNum}`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π ID –≤ —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
            activeTabs.push(newTabId);
            
            // –°–æ–∑–¥–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É –≤–∫–ª–∞–¥–∫–∏
            const tabButton = document.createElement('div');
            tabButton.className = 'tab';
            tabButton.dataset.tabId = newTabId;
            tabButton.textContent = `–ó–∞–∫–∞–∑ ${newTabNum}`;
            tabsNav.insertBefore(tabButton, addTabBtn);
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏
            const tabContent = document.createElement('div');
            tabContent.id = newTabId;
            tabContent.className = 'tab-content';
            cargoFormMain.insertBefore(tabContent, submitButton);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É
            initTab(newTabId);
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É
            switchTab(newTabId);
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –≤–∫–ª–∞–¥–∫–∏
        function closeTab(tabId) {
            // –ù–µ–ª—å–∑—è –∑–∞–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
            if (tabId === 'tab1') {
                alert('–ù–µ–ª—å–∑—è –∑–∞–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –≤–∫–ª–∞–¥–∫–∞
            const tabIndex = activeTabs.indexOf(tabId);
            if (tabIndex === -1) {
                return;
            }
            
            // –£–¥–∞–ª—è–µ–º –≤–∫–ª–∞–¥–∫—É –∏–∑ –º–∞—Å—Å–∏–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
            activeTabs.splice(tabIndex, 1);
            
            // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const tabButton = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
            if (tabButton) {
                tabButton.remove();
            }
            
            // –£–¥–∞–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏
            const tabContent = document.getElementById(tabId);
            if (tabContent) {
                tabContent.remove();
            }
            
            // –ï—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç–∞—è –≤–∫–ª–∞–¥–∫–∞ –±—ã–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ–π, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–µ—Ä–≤—É—é
            const activeTab = document.querySelector('.tab.active');
            if (!activeTab || activeTab.dataset.tabId === tabId) {
                switchTab(activeTabs[0]);
            }
            
            // –ü–µ—Ä–µ–Ω—É–º–µ—Ä—É–µ–º –≤–∫–ª–∞–¥–∫–∏
            renumberTabs();
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
        function switchTab(tabId) {
            // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelector(`.tab[data-tab-id="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
        function collectFormData() {
            // –û–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
            const formData = {
                telegramUserId: telegramData ? telegramData.id : 'unknown',
                telegramUserName: telegramData ? 
                    (telegramData.first_name || '') + (telegramData.last_name ? ' ' + telegramData.last_name : '') : 
                    'unknown',
                orders: {}
            };
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –≤–∫–ª–∞–¥–∫–∞–º
            activeTabs.forEach((tabId, index) => {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–µ–∫—Å + 1 –∫–∞–∫ –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                const orderNumber = index + 1;
                const tabIdNum = tabId.replace('tab', '');
                const tabFormData = getTabFormData(tabIdNum);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å –∫–ª—é—á–æ–º "–ó–∞–∫–∞–∑ N"
                formData.orders[`–ó–∞–∫–∞–∑ ${orderNumber}`] = tabFormData;
            });
            
            return formData;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã —Å –≤–∫–ª–∞–¥–∫–∏
        function getTabFormData(tabIdNum) {
            // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤
            const branch = document.getElementById(`branch-${tabIdNum}`).value;
            const marketplace = document.getElementById(`marketplace-${tabIdNum}`).value;
            const city = document.getElementById(`city-${tabIdNum}`).value;
            const warehouse = document.getElementById(`warehouse-${tabIdNum}`).value;
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ —á–∏—Å–ª–æ–≤—ã–µ –∫–æ–¥—ã
            const branchCode = branch === "–°–∫–ª–∞–¥ –ú–æ—Å–∫–≤–∞" ? 105 : branch === "–°–∫–ª–∞–¥ –ü–∏—Ç–µ—Ä" ? 107 : 0;
            
            const marketplaceCodes = {
                "Wildberries": 285,
                "Ozon": 287,
                "Yandex": 289
            };
            const marketplaceCode = marketplaceCodes[marketplace] || 0;
            
            const cityCodes = {
                "–ú–æ—Å–∫–≤–∞":175,
                "–¢—É–ª–∞":177,
                "–°–ü–±":179,
                "–ö–∞–∑–∞–Ω—å":181,
                "–ù–µ–≤–∏–Ω–Ω–æ–º—ã—Å—Å–∫":183,
                "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä":185,
                "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥":187,
                "–ü—Å–∫–æ–≤":189,
                "–ù–∞–±–µ—Ä–µ–∂–Ω—ã–µ –ß–µ–ª–Ω—ã":191,
                "–°–∞–º–æ–≤—ã–≤–æ–∑":193,
                "–†—è–∑–∞–Ω—å":195,
                "–í–æ–ª–æ–≥–¥–∞":197,
                "–ö–æ—Ç–æ–≤—Å–∫":199,
                "–í–æ–ª–≥–æ–≥—Ä–∞–¥":201,
                "–ö–∞–ª—É–≥–∞":565,
                "–í–ª–∞–¥–∏–º–∏—Ä":567
            };
            const cityCode = cityCodes[city] || 0;
            
            const warehouseCodes = {
                "–ö–æ–ª–µ–¥–∏–Ω–æ":203,
                "–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å":205,
                "–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å 2(–ø—è—Ç)":207,
                "–ö–∞–∑–∞–Ω—å":209,
                "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä":211,
                "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ (–ü - –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–π)":213,
                "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ (–ò - –ò—Å–ø—ã—Ç–∞—Ç–µ–ª–µ–π)":215,
                "–ù–µ–≤–∏–Ω–Ω–æ–º—ã—Å—Å–∫":217,
                "–¢—É–ª–∞":219,
                "–ü–æ–¥–æ–ª—å—Å–∫ (1 - –ü–æ–ª–∏–≤–∞–Ω–æ–≤—Å–∫–∞—è 9—Å5)":221,
                "–ü–æ–¥–æ–ª—å—Å–∫ (3 - –ü–æ–ª–∏–≤–∞–Ω–æ–≤—Å–∫–∞—è 9—Å3)":223,
                "–ß–µ—Ö–æ–≤ 2 (–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ –ù–æ–≤–æ—Å–µ–ª–∫–∏, –≤–ª. 11 —Å—Ç—Ä 7)":225,
                "–ë—É–≥—Ä—ã":227,
                "–†–§–¶ (–ü–µ—Ç—Ä–æ–°–ª–∞–≤—è–Ω–∫–∞)":229,
                "–®—É—à–∞—Ä—ã":231,
                "–£—Ç–∫–∏–Ω–∞ –ó–∞–≤–æ–¥—å":233,
                "–ß–µ—Ö–æ–≤-1 (–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ –ù–æ–≤–æ—Å–µ–ª–∫–∏, –≤–ª. 11 —Å—Ç—Ä 2)":235,
                "–¢—Ä–æ–∏—Ü–∫–∏–π (–Ø.–ú–∞—Ä–∫–µ—Ç, –°–ü–±)":237,
                "–ü—Å–∫–æ–≤ –°–¶":239,
                "–ù–∞–±–µ—Ä–µ–∂–Ω—ã–µ –ß–µ–ª–Ω—ã –°–¶":241,
                "–û–±—É—Ö–æ–≤–æ 2":243,
                "–ü–∞—Ä–≥–æ–ª–æ–≤–æ":245,
                "–Ø–ú –°–æ—Ñ—å–∏–Ω–æ":247,
                "–°–∞–º–æ–≤—ã–≤–æ–∑":249,
                "–ì—Ä–∏–≤–Ω–æ":251,
                "–ö–∞–ª—É–∂—Å–∫–æ–µ":253,
                "–ß–∞—à–Ω–∏–∫–æ–≤–æ":255,
                "–†—è–∑–∞–Ω—å (–¢—é—à–µ–≤—Å–∫–æ–µ)":257,
                "–ë–µ–ª—ã–µ –°—Ç–æ–ª–±—ã":259,
                "–ö–∞–ª—É–≥–∞ –°–¶":261,
                "–í–æ–ª–æ–≥–¥–∞":263,
                "–ö–æ—Ç–æ–≤—Å–∫":265,
                "–¢–∏—Ö–æ—Ä–µ—Ü–∫–∞—è 5":267,
                "–§–ë–°":269,
                "–ö–∞—Ä–∞–≤–∞–µ–≤—Å–∫–∞—è":271,
                "–°–æ—Ñ–∏–π—Å–∫–∞—è":273,
                "–õ–æ–º–æ–Ω–æ—Å–æ–≤–∞":275,
                "–ö–æ–ª–ø–∏–Ω–æ–†–§–¶":277,
                "–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å 1 (–°–†)":279,
                "–©–µ—Ä–±–∏–Ω–∫–∞":281,
                "–í–æ–ª–≥–æ–≥—Ä–∞–¥":283,
                "–û–±—É—Ö–æ–≤–æ":569,
                "–ü–æ–¥–æ–ª—å—Å–∫ (4 - –î–æ–º–æ–¥–µ–¥–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, 22)":571,
                "–í–ª–∞–¥–∏–º–∏—Ä":573,
                "–•–æ—Ä—É–≥–≤–∏–Ω–æ –†–§–¶":575,
                "–ú–°–ö–ú–û–°–ö–û–í–°–ö–ò–ô–•–ê–ë":577,
                "–ú–û–í–ù–£–ö–û–í–û–•–ê–ë":579,
                "–°–∞–ª–∞—Ä—å–µ–≤–æ":581,
                "–í–Ω—É–∫–æ–≤–æ":583
            };
            const warehouseCode = warehouseCodes[warehouse] || 0;
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ –¥–ª—è –¥–∞—Ç
            let marketplaceShipmentDate = "–Ω–µ –≤—ã–±—Ä–∞–Ω–æ";
            const marketplaceSelect = document.getElementById(`marketplaceShipmentDate-${tabIdNum}`);
            if (marketplaceSelect.selectedIndex > 0) {
                marketplaceShipmentDate = marketplaceSelect.options[marketplaceSelect.selectedIndex].textContent;
            }
            
            let ncgShipmentDate = "–Ω–µ –≤—ã–±—Ä–∞–Ω–æ";
            const ncgSelect = document.getElementById(`ncgShipmentDate-${tabIdNum}`);
            if (ncgSelect.selectedIndex > 0) {
                ncgShipmentDate = ncgSelect.options[ncgSelect.selectedIndex].textContent;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å —Å–∫–ª–∞–¥–∞
            const address = document.getElementById(`address-${tabIdNum}`).textContent || "–Ω–µ —É–∫–∞–∑–∞–Ω";
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–∏–ø —É–ø–∞–∫–æ–≤–∫–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –∫–æ–¥
            const packageType = document.querySelector(`input[name="packageType-${tabIdNum}"]:checked`).value;
            const packageTypeCodes = {
                "–∫–æ—Ä–æ–±": 53,
                "–ø–∞–ª–ª–µ—Ç–∞": 55,
                "–º–æ–Ω–æ–ø–∞–ª–ª–µ—Ç–∞": 543
            };
            const packageTypeCode = packageTypeCodes[packageType] || 0;
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ–±—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –∫–æ–¥—ã
            const packingList = document.querySelector(`input[name="packingList-${tabIdNum}"]:checked`).value;
            const packingListCode = packingList === "–¥–∞" ? 1 : 0;
            
            const barcodeCheck = document.querySelector(`input[name="barcodeCheck-${tabIdNum}"]:checked`).value;
            const barcodeCheckCode = barcodeCheck === "–¥–∞" ? 1 : 0;
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –æ—Ç—á–µ—Ç
            const now = new Date();
            const currentDate = now.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: '2-digit'
            });
            const currentTime = now.toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å —á–∏—Å–ª–æ–≤—ã–º–∏ –∫–æ–¥–∞–º–∏
            const tabData = {
                branch: branchCode,
                marketplace: marketplaceCode,
                city: cityCode,
                warehouse: warehouseCode,
                store_name: warehouse, // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∫–ª–∞–¥–∞ –∫–∞–∫ —Ç–µ–∫—Å—Ç
                marketplaceShipmentDate,
                ncgShipmentDate,
                warehouseAddress: address,
                packageType: packageTypeCode,
                packingList: packingListCode,
                barcodeCheck: barcodeCheckCode,
                package_places: parseInt(document.getElementById(`package_places-${tabIdNum}`).value) || 0,
                cargoWeight: parseFloat(document.getElementById(`cargoWeight-${tabIdNum}`).value) || 0
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º boxCount —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ç–∏–ø –ø–∞–ª–ª–µ—Ç–∞ –∏–ª–∏ –º–æ–Ω–æ–ø–∞–ª–ª–µ—Ç–∞
            const selectedPackageType = document.querySelector(`input[name="packageType-${tabIdNum}"]:checked`).value;
            if (selectedPackageType === "–ø–∞–ª–ª–µ—Ç–∞" || selectedPackageType === "–º–æ–Ω–æ–ø–∞–ª–ª–µ—Ç–∞") {
                tabData.boxCount = parseInt(document.getElementById(`boxCount-${tabIdNum}`).value) || 0;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —É–ø–∞–∫–æ–≤–∫–∏
            if (packageType === "–∫–æ—Ä–æ–±") {
                // –î–ª—è –∫–æ—Ä–æ–±–æ–≤
                const boxMarking = document.querySelector(`input[name="boxMarking-${tabIdNum}"]:checked`).value;
                tabData.boxMarking = boxMarking === "–¥–∞" ? 1 : 0;
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è –∑–Ω–∞—á–µ–Ω–∏–µ–º 0
                tabData.cargoArrivalType = 0;
                tabData.bulkBoxMarking = 0;
                tabData.palletization = 0;
            } else if (packageType === "–ø–∞–ª–ª–µ—Ç–∞" || packageType === "–º–æ–Ω–æ–ø–∞–ª–ª–µ—Ç–∞") {
                // –î–ª—è –ø–∞–ª–ª–µ—Ç –∏ –º–æ–Ω–æ–ø–∞–ª–ª–µ—Ç
                const cargoArrivalType = document.querySelector(`input[name="cargoArrivalType-${tabIdNum}"]:checked`).value;
                const cargoArrivalTypeCodes = {
                    "–≥–æ—Ç–æ–≤—ã–π –≤–∏–¥": 545,
                    "—Ä–æ—Å—Å—ã–ø—å—é": 547
                };
                tabData.cargoArrivalType = cargoArrivalTypeCodes[cargoArrivalType] || 0;
                tabData.boxMarking = 0; // –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–æ–ª–µ
                
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ç–∏–ø "–†–æ—Å—Å—ã–ø—å—é", –¥–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
                if (cargoArrivalType === "—Ä–æ—Å—Å—ã–ø—å—é") {
                    const bulkBoxMarking = document.querySelector(`input[name="bulkBoxMarking-${tabIdNum}"]:checked`).value;
                    tabData.bulkBoxMarking = bulkBoxMarking === "–¥–∞" ? 1 : 0;
                    
                    const palletization = document.querySelector(`input[name="palletization-${tabIdNum}"]:checked`).value;
                    const palletizationCodes = {
                        "–Ω–µ –Ω—É–∂–Ω–æ": 549,
                        "—Ç–æ–ª—å–∫–æ –ø–∞–ª–ª–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ": 551,
                        "–ø–æ–¥–¥–æ–Ω –∏ –ø–∞–ª–ª–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ": 553
                    };
                    tabData.palletization = palletizationCodes[palletization] || 0;
                } else {
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è –∑–Ω–∞—á–µ–Ω–∏–µ–º 0
                    tabData.bulkBoxMarking = 0;
                    tabData.palletization = 0;
                }
            }
            
            // –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –∑–∞–±–æ—Ä –≥—Ä—É–∑–∞, –¥–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            const needPickup = document.querySelector(`input[name="needPickup-${tabIdNum}"]:checked`).value;
            tabData.needPickup = needPickup === "–¥–∞" ? 1 : 0;
            
            if (needPickup === "–¥–∞") {
                tabData.pickupAddress = document.getElementById(`pickupAddress-${tabIdNum}`).value || "–Ω–µ —É–∫–∞–∑–∞–Ω";
                tabData.pickupTimeFrom = document.getElementById(`pickupTimeFrom-${tabIdNum}`).value || "–Ω–µ —É–∫–∞–∑–∞–Ω–æ";
                tabData.pickupTimeTo = document.getElementById(`pickupTimeTo-${tabIdNum}`).value || "–Ω–µ —É–∫–∞–∑–∞–Ω–æ";
                tabData.contactPhone = document.getElementById(`contactPhone-${tabIdNum}`).value || "–Ω–µ —É–∫–∞–∑–∞–Ω";
                tabData.accessComment = document.getElementById(`accessComment-${tabIdNum}`).value || "–Ω–µ —É–∫–∞–∑–∞–Ω–æ";
                
                const driverHelp = document.querySelector(`input[name="driverHelp-${tabIdNum}"]:checked`).value;
                tabData.driverHelp = driverHelp === "–¥–∞" ? 1 : 0;
            } else {
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–∞–±–æ—Ä–∞ –≥—Ä—É–∑–∞
                tabData.pickupAddress = "–Ω–µ—Ç";
                tabData.pickupTimeFrom = "–Ω–µ—Ç";
                tabData.pickupTimeTo = "–Ω–µ—Ç";
                tabData.contactPhone = "–Ω–µ—Ç";
                tabData.accessComment = "–Ω–µ—Ç";
                tabData.driverHelp = 0;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
            tabData.currentDate = currentDate;
            tabData.currentTime = currentTime;
            
            return tabData;
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –Ω–∞ –≤–∫–ª–∞–¥–∫–µ
        function validateTabForm(tabIdNum) {
            const branch = document.getElementById(`branch-${tabIdNum}`).value;
            const marketplace = document.getElementById(`marketplace-${tabIdNum}`).value;
            const city = document.getElementById(`city-${tabIdNum}`).value;
            const warehouse = document.getElementById(`warehouse-${tabIdNum}`).value;
            const marketplaceShipmentDate = document.getElementById(`marketplaceShipmentDate-${tabIdNum}`).value;
            const ncgShipmentDate = document.getElementById(`ncgShipmentDate-${tabIdNum}`).value;
            const packageType = document.querySelector(`input[name="packageType-${tabIdNum}"]:checked`);
            const package_places = document.getElementById(`package_places-${tabIdNum}`).value;
            const cargoWeight = document.getElementById(`cargoWeight-${tabIdNum}`).value;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            if (!branch || !marketplace || !city || !warehouse || 
                !marketplaceShipmentDate || !ncgShipmentDate || !packageType ||
                !package_places || !cargoWeight) {
                return false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–µ –ø–æ–ª—è –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É–ø–∞–∫–æ–≤–∫–∏
            const packingList = document.querySelector(`input[name="packingList-${tabIdNum}"]:checked`);
            const barcodeCheck = document.querySelector(`input[name="barcodeCheck-${tabIdNum}"]:checked`);
            
            if (!packingList || !barcodeCheck) {
                return false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —É–ø–∞–∫–æ–≤–∫–∏
            if (packageType.value === "–∫–æ—Ä–æ–±") {
                const boxMarking = document.querySelector(`input[name="boxMarking-${tabIdNum}"]:checked`);
                if (!boxMarking) {
                    return false;
                }
            } else if (packageType.value === "–ø–∞–ª–ª–µ—Ç–∞" || packageType.value === "–º–æ–Ω–æ–ø–∞–ª–ª–µ—Ç–∞") {
                const cargoArrivalType = document.querySelector(`input[name="cargoArrivalType-${tabIdNum}"]:checked`);
                const boxCount = document.getElementById(`boxCount-${tabIdNum}`).value;
                
                if (!cargoArrivalType || !boxCount) {
                    return false;
                }
                
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ç–∏–ø "–†–æ—Å—Å—ã–ø—å—é", –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
                if (cargoArrivalType.value === "—Ä–æ—Å—Å—ã–ø—å—é") {
                    const bulkBoxMarking = document.querySelector(`input[name="bulkBoxMarking-${tabIdNum}"]:checked`);
                    const palletization = document.querySelector(`input[name="palletization-${tabIdNum}"]:checked`);
                    
                    if (!bulkBoxMarking || !palletization) {
                        return false;
                    }
                }
            }
            
            // –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –∑–∞–±–æ—Ä –≥—Ä—É–∑–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            const needPickup = document.querySelector(`input[name="needPickup-${tabIdNum}"]:checked`);
            if (needPickup && needPickup.value === "–¥–∞") {
                const pickupAddress = document.getElementById(`pickupAddress-${tabIdNum}`).value;
                const pickupTimeFrom = document.getElementById(`pickupTimeFrom-${tabIdNum}`).value;
                const pickupTimeTo = document.getElementById(`pickupTimeTo-${tabIdNum}`).value;
                const contactPhone = document.getElementById(`contactPhone-${tabIdNum}`).value;
                
                if (!pickupAddress || !pickupTimeFrom || !pickupTimeTo || !contactPhone) {
                    return false;
                }
            }
            
            return true;
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        async function sendFormDataToServer(formData) {
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                loadingOverlay.classList.remove('hidden');
                
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π –∏–∑ –æ–±—ä–µ–∫—Ç–∞
                const removeEmptyFields = (obj) => {
                    // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –æ–±—ä–µ–∫—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
                    if (typeof obj !== 'object' || obj === null) {
                        return obj;
                    }
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                    const result = Array.isArray(obj) ? [] : {};
                    
                    // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞
                    Object.entries(obj).forEach(([key, value]) => {
                        // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç, —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ—á–∏—â–∞–µ–º –µ–≥–æ
                        if (typeof value === 'object' && value !== null) {
                            const cleaned = removeEmptyFields(value);
                            
                            // –ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –æ–±—ä–µ–∫—Ç –Ω–µ –ø—É—Å—Ç–æ–π, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                            if (Object.keys(cleaned).length > 0) {
                                result[key] = cleaned;
                            }
                        } 
                        // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –ø—É—Å—Ç–æ–µ, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        else if (value !== '' && value !== null && value !== undefined) {
                            result[key] = value;
                        }
                    });
                    
                    return result;
                };
                
                // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π
                const cleanedFormData = removeEmptyFields(formData);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(cleanedFormData)
                });
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                loadingOverlay.classList.add('hidden');
                
                // –ü—Ä–æ—Å—Ç–æ —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã "load failed"
                return {
                    success: true,
                    data: { message: "–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞" }
                };
                
            } catch (error) {
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                loadingOverlay.classList.add('hidden');
                
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                
                // –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏, –≤—Å–µ —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —É—Å–ø–µ—à–Ω–æ–π
                // –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –æ—à–∏–±–∫—É "load failed", –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –¥–æ—à–µ–ª –¥–æ —Å–µ—Ä–≤–µ—Ä–∞
                return {
                    success: true,
                    data: { message: "–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞, –Ω–æ –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–≤—è–∑—å—é" }
                };
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        async function submitForm(e) {
            if (e && e.preventDefault) e.preventDefault();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –≤–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
            let isValid = true;
            
            for (const tabId of activeTabs) {
                const tabIdNum = tabId.replace('tab', '');
                
                if (!validateTabForm(tabIdNum)) {
                    isValid = false;
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Å –æ—à–∏–±–∫–æ–π
                    switchTab(tabId);
                    
                    alert(`–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ –∑–∞–∫–∞–∑–µ ${tabIdNum}`);
                    return;
                }
            }
            
            // –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞ –≤–∞–ª–∏–¥–Ω–∞, —Å–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            const formData = collectFormData();
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            const result = await sendFormDataToServer(formData);
            
            if (result.success) {
                alert('–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
                
                // –ï—Å–ª–∏ –º—ã –≤ Telegram WebApp, –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.close();
                }
            } else {
                alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏: ${result.error}`);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–∏
        addTabBtn.addEventListener('click', addTab);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        tabsNav.addEventListener('click', function(e) {
            if (e.target.classList.contains('tab') && !e.target.classList.contains('active')) {
                switchTab(e.target.dataset.tabId);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        cargoFormMain.addEventListener('submit', submitForm);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram WebApp
            initTelegramApp();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadGoogleSheet();
        });
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –¥–∞—Ç
        function updateDateSelectors(tabId) {
            const branch = document.getElementById(`branch-${tabId}`).value;
            const marketplace = document.getElementById(`marketplace-${tabId}`).value;
            const city = document.getElementById(`city-${tabId}`).value;
            const warehouse = document.getElementById(`warehouse-${tabId}`).value;
            
            console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç –¥–ª—è:', { branch, marketplace, city, warehouse });
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ
            const record = tableData.find(row => 
                row.branch === branch && 
                row.marketplace === marketplace && 
                row.city === city && 
                row.warehouse === warehouse
            );
            
            console.log('–ù–∞–π–¥–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å:', record);
            
            if (!record) {
                console.warn('–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–∞—Ç
            const dateSelectors = document.querySelectorAll(`#tab-${tabId} .date-selector`);
            
            // –û—á–∏—â–∞–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä
            dateSelectors.forEach((selector, index) => {
                const dateField = `date${index + 1}`;
                const date = record[dateField];
                
                console.log(`–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç—ã ${dateField}:`, date);
                
                // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ–ø—Ü–∏–∏
                selector.innerHTML = '';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é –æ–ø—Ü–∏—é
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É';
                selector.appendChild(emptyOption);
                
                // –ï—Å–ª–∏ –¥–∞—Ç–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –µ—ë –∫–∞–∫ –æ–ø—Ü–∏—é
                if (date && date.trim()) {
                    const option = document.createElement('option');
                    option.value = date;
                    option.textContent = date;
                    selector.appendChild(option);
                }
            });
        }
    </script>
</body>
</html>
